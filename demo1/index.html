<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<title>AR Demo</title>
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #000;
    color: #fff;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    min-height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  #status {
    text-align: center;
    font-size: 0.8rem;
    color: #888;
    letter-spacing: 1px;
  }
</style>
</head>
<body>

<div id="status">Loading AR...</div>

<script>
(function() {
  'use strict';

  // ===== READ ?item= PARAMETER =====
  var params = new URLSearchParams(window.location.search);
  var item = params.get('item');

  if (!item) {
    document.getElementById('status').textContent = 'Error: No item specified. Use ?item=ModelName';
    return;
  }

  // ===== MODEL PATH =====
  // Pattern: models/{item}/{item}.glb and models/{item}/{item}.usdz
  var MODEL_BASE = 'models';
  var glbPath = MODEL_BASE + '/' + item + '/' + item + '.glb';
  var usdzPath = MODEL_BASE + '/' + item + '/' + item + '.usdz';

  // ===== OS DETECTION =====
  function getOS() {
    var ua = navigator.userAgent || navigator.vendor;
    if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) return 'ios';
    if (/Macintosh/.test(ua) && navigator.maxTouchPoints > 1) return 'ios';
    if (/android/i.test(ua)) return 'android';
    return 'other';
  }

  // ===== iOS: Direct AR Quick Look (scale locked) =====
  function launchIOSAR() {
    var fullUrl = new URL(usdzPath, window.location.href).href;
    var a = document.createElement('a');
    a.setAttribute('rel', 'ar');
    a.setAttribute('href', fullUrl + '#allowsContentScaling=0');
    var img = document.createElement('img');
    a.appendChild(img);
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
  }

  // ===== Android: Direct Scene Viewer (ar_only, scale locked) =====
  function launchAndroidAR() {
    var fullUrl = new URL(glbPath, window.location.href).href;

    var intentUrl = 'intent://arvr.google.com/scene-viewer/1.0?file=' +
      encodeURIComponent(fullUrl) +
      '&mode=ar_only' +
      '&resizable=false' +
      '&title=' + encodeURIComponent(item) +
      '#Intent;scheme=https;package=com.google.android.googlequicksearchbox;action=android.intent.action.VIEW;S.browser_fallback_url=' +
      encodeURIComponent(window.location.href) +
      ';end;';

    window.location.href = intentUrl;
  }

  // ===== AUTO-LAUNCH AR ON PAGE LOAD =====
  var os = getOS();

  if (os === 'ios') {
    launchIOSAR();
  } else if (os === 'android') {
    launchAndroidAR();
  } else {
    document.getElementById('status').textContent = 'AR is available on mobile devices only.';
  }

})();
</script>

</body>
</html>
